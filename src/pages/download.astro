---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const GOOGLE_FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSct4n1_PbVZsrBoactOIpYwNGzvM2Es0-4jx7mLYxmRdRlCcg/formResponse";
const EMAIL_FIELD_NAME = "entry.778960156";
---

<BaseLayout title="Download Course | Claude Code for Marketers" description="Get the interactive course materials">
  <Header />
  
  <section class="download-section">
    <div class="container">
      <div class="download-card" id="email-form-card">
        <div class="download-icon">üìß</div>
        <h1>Get the Course Materials</h1>
        <p class="download-description">
          Enter your email to download the complete interactive course. 
          We'll also send you updates and bonus content.
        </p>
        
        <form id="email-form" class="email-form">
          <input 
            type="email" 
            name="email" 
            placeholder="your@email.com" 
            required 
            class="email-input"
            id="email-input"
          />
          <button type="submit" class="submit-btn">
            Download Course ‚Üí
          </button>
        </form>
        
        <p class="privacy-note">
          No spam, ever. Unsubscribe anytime.
        </p>
      </div>

      <div class="download-card hidden" id="thank-you-card">
        <div class="download-icon">üéâ</div>
        <h1>Thank You!</h1>
        <p class="download-description">
          Your download is ready. Click below to get the course materials.
        </p>
        
        <a 
          href="https://go.mtri.me/cm" 
          class="download-btn"
          id="download-link"
        >
          Download Course (ZIP) ‚Üí
        </a>
        
        <div class="next-steps">
          <h3>Next Steps:</h3>
          <ol>
            <li>Extract the ZIP file</li>
            <li>Open the folder in Claude Code</li>
            <li>Type <code>/start-0-0</code> to begin!</li>
          </ol>
        </div>

        <p class="bonus-note">
          üéÅ Check your email for a special bonus lesson!
        </p>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>

<script define:vars={{ GOOGLE_FORM_ACTION, EMAIL_FIELD_NAME }}>
  const form = document.getElementById('email-form');
  const emailInput = document.getElementById('email-input');
  const emailFormCard = document.getElementById('email-form-card');
  const thankYouCard = document.getElementById('thank-you-card');

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = emailInput.value;
    
    // Create hidden iframe for form submission
    const iframe = document.createElement('iframe');
    iframe.name = 'hidden_iframe';
    iframe.style.display = 'none';
    document.body.appendChild(iframe);
    
    // Create a form element to submit to Google
    const googleForm = document.createElement('form');
    googleForm.method = 'POST';
    googleForm.action = GOOGLE_FORM_ACTION;
    googleForm.target = 'hidden_iframe';
    
    // Add email as hidden input
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = EMAIL_FIELD_NAME;
    input.value = email;
    googleForm.appendChild(input);
    
    // Submit the form
    document.body.appendChild(googleForm);
    googleForm.submit();
    
    // Show thank you card
    emailFormCard.classList.add('hidden');
    thankYouCard.classList.remove('hidden');
    
    // Store in localStorage
    localStorage.setItem('cc4m_email', email);
    localStorage.setItem('cc4m_downloaded', 'true');
    
    // Cleanup after submission
    setTimeout(() => {
      document.body.removeChild(googleForm);
      document.body.removeChild(iframe);
    }, 1000);
  });

  // Check if already downloaded
  if (localStorage.getItem('cc4m_downloaded') === 'true') {
    emailFormCard.classList.add('hidden');
    thankYouCard.classList.remove('hidden');
  }
</script>

<style>
  .download-section {
    min-height: calc(100vh - 200px);
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--cream) 0%, #E8E4DB 100%);
    padding: 60px 24px;
  }

  .download-card {
    background: white;
    border: 4px solid var(--charcoal);
    box-shadow: 12px 12px 0 var(--charcoal);
    padding: 60px;
    max-width: 500px;
    text-align: center;
  }

  .download-card.hidden {
    display: none;
  }

  .download-icon {
    font-size: 4em;
    margin-bottom: 20px;
  }

  .download-card h1 {
    font-family: var(--font-display);
    font-size: 2.2em;
    color: var(--charcoal);
    margin-bottom: 15px;
  }

  .download-description {
    color: #666;
    line-height: 1.7;
    margin-bottom: 30px;
  }

  .email-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .email-input {
    padding: 16px 20px;
    font-size: 1.1em;
    border: 3px solid var(--charcoal);
    background: var(--cream);
    font-family: var(--font-body);
    text-align: center;
  }

  .email-input:focus {
    outline: none;
    border-color: var(--olive);
    background: white;
  }

  .submit-btn {
    padding: 18px 30px;
    font-size: 1.1em;
    font-weight: 700;
    font-family: var(--font-display);
    background: var(--mustard);
    color: var(--charcoal);
    border: 3px solid var(--charcoal);
    cursor: pointer;
    box-shadow: 6px 6px 0 var(--charcoal);
    transition: all 0.2s ease;
  }

  .submit-btn:hover {
    transform: translate(-3px, -3px);
    box-shadow: 9px 9px 0 var(--charcoal);
  }

  .privacy-note {
    font-size: 0.85em;
    color: #999;
    margin-top: 20px;
  }

  .download-btn {
    display: inline-block;
    padding: 20px 40px;
    font-size: 1.2em;
    font-weight: 700;
    font-family: var(--font-display);
    background: var(--olive);
    color: white;
    border: 3px solid var(--charcoal);
    text-decoration: none;
    box-shadow: 8px 8px 0 var(--charcoal);
    transition: all 0.2s ease;
    margin-bottom: 30px;
  }

  .download-btn:hover {
    transform: translate(-4px, -4px);
    box-shadow: 12px 12px 0 var(--charcoal);
    color: white;
  }

  .next-steps {
    background: var(--cream);
    border: 2px solid var(--charcoal);
    padding: 25px;
    text-align: left;
    margin-bottom: 20px;
  }

  .next-steps h3 {
    font-family: var(--font-display);
    font-size: 1.1em;
    margin-bottom: 15px;
    color: var(--charcoal);
  }

  .next-steps ol {
    margin: 0;
    padding-left: 20px;
  }

  .next-steps li {
    margin-bottom: 8px;
    color: var(--charcoal);
  }

  .next-steps code {
    background: var(--olive);
    color: white;
    padding: 2px 8px;
    font-family: monospace;
  }

  .bonus-note {
    color: var(--rust);
    font-weight: 600;
    margin-top: 20px;
  }

  @media (max-width: 600px) {
    .download-card {
      padding: 40px 25px;
    }

    .download-card h1 {
      font-size: 1.8em;
    }
  }
</style>
