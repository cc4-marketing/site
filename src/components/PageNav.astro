---
interface TocItem {
    id: string;
    title: string;
    level: number;
}

interface Props {
    items: TocItem[];
}

const { items } = Astro.props;
---

<aside class="page-nav">
    <div class="toc-title">On This Page</div>
    <ul class="toc-list">
        {items.map(item => (
            <li class={`toc-item ${item.level > 2 ? 'nested' : ''}`}>
                <a href={`#${item.id}`} class="toc-link">{item.title}</a>
            </li>
        ))}
    </ul>
    <div class="toc-footer">
        <a href="#" class="feedback-link">Give feedback â†’</a>
    </div>
</aside>

<style>
    .page-nav {
        position: fixed;
        right: 0;
        top: 0;
        width: var(--toc-width);
        height: 100vh;
        padding: 48px 20px;
        overflow-y: auto;
        z-index: 50;
    }

    .toc-title {
        font-size: 0.75em;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 16px;
    }

    .toc-list {
        list-style: none;
    }

    .toc-item {
        margin-bottom: 2px;
    }

    .toc-link {
        display: block;
        padding: 6px 12px;
        color: var(--text-muted);
        font-size: 0.82em;
        border-left: 1px solid transparent;
        transition: all 0.15s;
        margin-left: -1px;
    }

    .toc-link:hover {
        color: var(--text);
    }

    .toc-link.active {
        color: var(--plum);
        border-left-color: var(--accent);
    }

    .toc-item.nested .toc-link {
        padding-left: 24px;
        font-size: 0.78em;
    }

    .toc-footer {
        margin-top: 32px;
        padding-top: 16px;
        border-top: 1px solid rgba(0,0,0,0.06);
    }

    .feedback-link {
        font-size: 0.8em;
        color: var(--text-muted);
    }

    .feedback-link:hover {
        color: var(--plum);
    }

    @media (max-width: 1100px) {
        .page-nav {
            display: none;
        }
    }
</style>

<script>
    const sections = document.querySelectorAll('h2[id], h3[id]');
    const tocLinks = document.querySelectorAll('.toc-link');
    
    window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
            if (window.scrollY >= (section as HTMLElement).offsetTop - 100) {
                current = section.getAttribute('id') || '';
            }
        });
        tocLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === '#' + current);
        });
    });
</script>
